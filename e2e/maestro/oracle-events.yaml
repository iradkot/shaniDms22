appId: com.shanidms22
---
# Oracle / Events smoke: pick an event, ensure previous events list renders.

- launchApp:
    clearState: true

# Either we land on tabs (already authenticated) or we land on login.
- extendedWaitUntil:
    visible:
      id: tabs.navigator
    timeout: 15000
    optional: true

- extendedWaitUntil:
    visible:
      id: login.screen
    timeout: 15000
    optional: true

# Deterministic E2E login (only available in E2E-enabled builds).
- runFlow:
    when:
      visible:
        id: login.screen
    commands:
      - extendedWaitUntil:
          visible:
            id: login.e2eButton
          timeout: 15000
      - tapOn:
          id: login.e2eButton

# Wait for tabs.
- extendedWaitUntil:
    visible:
      id: tabs.navigator
    timeout: 30000

# Go to Oracle tab.
- tapOn:
    id: tab.oracle

- extendedWaitUntil:
    visible:
      id: screen.oracle
    timeout: 30000

# Keep this flow deterministic: disable network cache refresh.
# Note: app state is cleared on launch, so this starts as ON by default.
- scrollUntilVisible:
    element:
      id: oracle.header.refreshOnExecuteToggle
    direction: UP
    timeout: 8000
    optional: true

- scrollUntilVisible:
    element:
      id: oracle.header.refreshOnExecuteToggle
    direction: DOWN
    timeout: 15000

- tapOn:
    id: oracle.header.refreshOnExecuteToggle

# Recent events list should appear.
- extendedWaitUntil:
    visible:
      id: oracle.events.list
    timeout: 30000

# Either we have events (tap the first), or we show the empty state.
- extendedWaitUntil:
    visible:
      id: oracle.events.row.0
    timeout: 15000
    optional: true

- runFlow:
    when:
      visible:
        id: oracle.events.row.0
    commands:
      - tapOn:
          id: oracle.events.row.0

      # Insights no longer auto-run on selection; Execute starts collection + analysis.
      - scrollUntilVisible:
          element:
            id: oracle.execute.button
          direction: UP
          timeout: 12000
          optional: true

      - scrollUntilVisible:
          element:
            id: oracle.execute.button
          direction: DOWN
          timeout: 20000

      - tapOn:
          id: oracle.execute.button

      # Ensure chart renders (may be below the fold on smaller devices).
      - scrollUntilVisible:
          element:
            id: chart.oracle.ghostGraph
          direction: DOWN
          timeout: 60000

      # Ensure strategies section appears (may be below the fold).
      - scrollUntilVisible:
          element:
            id: oracle.strategies.list
          direction: DOWN
          timeout: 30000

      - assertVisible:
          id: oracle.strategies.list

      - scrollUntilVisible:
          element:
            id: oracle.disclaimer
          direction: DOWN
          timeout: 30000

      - assertVisible:
          id: oracle.disclaimer

      # Ensure previous events section appears (may be below the fold).
      - scrollUntilVisible:
          element:
            id: oracle.previous.list
          direction: DOWN
          timeout: 30000

      - assertVisible:
          id: oracle.previous.list

      # Try to bring either the "no matches" empty state or the first row into view.
      - scrollUntilVisible:
          element:
            id: oracle.previous.noMatches
          direction: UP
          timeout: 8000
          optional: true

      - scrollUntilVisible:
          element:
            id: oracle.previous.noMatches
          direction: DOWN
          timeout: 8000
          optional: true

      - scrollUntilVisible:
          element:
            id: oracle.previous.row.0
          direction: UP
          timeout: 8000
          optional: true

      - scrollUntilVisible:
          element:
            id: oracle.previous.row.0
          direction: DOWN
          timeout: 8000
          optional: true

      # If there are no matches, we expect the explicit empty state.
      - runFlow:
          when:
            visible:
              id: oracle.previous.noMatches
          commands:
            - assertVisible:
                id: oracle.previous.noMatches

      # If at least one previous event exists, tap it and verify details.
      - runFlow:
          when:
            visible:
              id: oracle.previous.row.0
          commands:
            - tapOn:
                id: oracle.previous.row.0
            - scrollUntilVisible:
                element:
                  id: oracle.previous.details
                direction: DOWN
                timeout: 30000
            - assertVisible:
                id: oracle.previous.details

      - takeScreenshot: oracle-events

- runFlow:
    when:
      visible: "No recent events yet."
    commands:
      - takeScreenshot: oracle-no-recent-events
